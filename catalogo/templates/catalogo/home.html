{% extends "catalogo/base.html" %}
{% load custom_filters %}
{% load static %}
{% block title %}Inicio â€” Tienda MVC{% endblock %}

{% block content %}
<section class="space-y-10">

  <!-- SecciÃ³n Productos MÃ¡s Vendidos -->
  <div>
    <h2 class="text-2xl font-bold text-indigo-700 mb-4">ðŸ›’ Productos mÃ¡s vendidos</h2>
    <div class="overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm p-6">
      <table class="w-full text-sm">
        <thead class="text-left text-gray-600 border-b">
          <tr>
            <th class="py-2">Producto</th>
            <th class="py-2">Cantidad vendida</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos_vendidos %}
          <tr class="border-b hover:bg-indigo-50/40">
            <td class="py-2 font-medium">{{ p.producto__nombre }}</td>
            <td class="py-2">{{ p.total_vendido }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="2" class="text-gray-500 py-2">Sin datos aÃºn.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <canvas id="chartProductos" class="mt-6"></canvas>
    </div>
  </div>

  <!-- SecciÃ³n Clientes con mÃ¡s Ventas -->
  <div>
    <h2 class="text-2xl font-bold text-indigo-700 mb-4">ðŸ‘¥ Clientes con mÃ¡s ventas</h2>
    <div class="overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm p-6">
      <table class="w-full text-sm">
        <thead class="text-left text-gray-600 border-b">
          <tr>
            <th class="py-2">Cliente</th>
            <th class="py-2">Ventas realizadas</th>
          </tr>
        </thead>
        <tbody>
          {% for c in clientes_top %}
          <tr class="border-b hover:bg-indigo-50/40">
            <td class="py-2 font-medium">{{ c.cliente__nombre }}</td>
            <td class="py-2">{{ c.total_compras }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="2" class="text-gray-500 py-2">Sin datos aÃºn.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <canvas id="chartClientes" class="mt-6"></canvas>
    </div>
  </div>

</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Productos mÃ¡s vendidos ---
  const productosData = {
    labels: {{ productos_vendidos|pluck:"producto__nombre"|safe }},
    datasets: [{
      label: 'Cantidad vendida',
      data: {{ productos_vendidos|pluck:"total_vendido"|safe }},
      backgroundColor: '#6366f1',
    }]
  };
  new Chart(document.getElementById('chartProductos'), {
    type: 'bar',
    data: productosData,
    options: { responsive: true, plugins: { legend: { display: false } } }
  });

  // --- Clientes con mÃ¡s ventas ---
  const clientesData = {
    labels: {{ clientes_top|pluck:"cliente__nombre"|safe }},
    datasets: [{
      label: 'Ventas',
      data: {{ clientes_top|pluck:"total_compras"|safe }},
      backgroundColor: ['#4f46e5', '#6366f1', '#818cf8', '#a5b4fc', '#c7d2fe']
    }]
  };
  new Chart(document.getElementById('chartClientes'), {
    type: 'pie',
    data: clientesData,
    options: { responsive: true }
  });
</script>
{% endblock %}
